!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MapboxScalebar=t():e.MapboxScalebar=t()}(this,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){class o{constructor(e={}){this.options={units:e.units||"metric",maxWidth:e.maxWidth||150,color:e.color||"#000000",backgroundColor:e.backgroundColor||"rgba(255, 255, 255, 0.8)",textColor:e.textColor||"#000000",fontSize:e.fontSize||12,fontFamily:e.fontFamily||"Arial, sans-serif",strokeWidth:e.strokeWidth||2,strokeColor:e.strokeColor||"#000000",transparency:void 0!==e.transparency?e.transparency:.8,padding:e.padding||10,position:e.position||"bottom-left",showFrame:void 0!==e.showFrame?e.showFrame:!0,frameColor:e.frameColor||"#000000",frameWidth:e.frameWidth||1,framePadding:e.framePadding||5},this._container=null,this._canvas=null,this._ctx=null,this._map=null,this._updateBound=this._update.bind(this)}onAdd(e){return this._map=e,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapbox-scalebar-ctrl",this._container.style.position="relative",this._container.style.pointerEvents="none",this._canvas=document.createElement("canvas"),this._canvas.style.display="block",this._ctx=this._canvas.getContext("2d"),this._container.appendChild(this._canvas),this._map.on("zoom",this._updateBound),this._map.on("move",this._updateBound),this._map.on("resize",this._updateBound),this._update(),this._container}onRemove(){this._map&&(this._map.off("zoom",this._updateBound),this._map.off("move",this._updateBound),this._map.off("resize",this._updateBound)),this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._map=null,this._container=null,this._canvas=null,this._ctx=null}_update(){if(this._map&&this._ctx){const e=this._map.getCenter(),t=e.lat,n=this._map.getZoom(),o=this._calculateScale(t,n);this._render(o)}}_calculateScale(e,t){const n=40075017*Math.cos(e*Math.PI/180)/Math.pow(2,t+8),o=this.options.maxWidth*n;let r,i,a;if("metric"===this.options.units||"both"===this.options.units)if(o>=1e3)r=this._getRoundedDistance(o/1e3),i="km",a=1e3*r/n;else{r=this._getRoundedDistance(o),i="m",a=r/n}let s=null;if("imperial"===this.options.units||"both"===this.options.units){const e=3.28084*o;if(e>=5280){const t=this._getRoundedDistance(e/5280);s={distance:t,unit:"mi",pixelWidth:t*5280*.3048/n}}else{const t=this._getRoundedDistance(e);s={distance:t,unit:"ft",pixelWidth:.3048*t/n}}}return{metric:"imperial"!==this.options.units?{distance:r,unit:i,pixelWidth:a}:null,imperial:s}}_getRoundedDistance(e){const t=Math.pow(10,Math.floor(Math.log10(e))),n=e/t;return n>=5?5*t:n>=2?2*t:t}_render(e){const t=window.devicePixelRatio||1,n=this.options.padding,o=this.options.showFrame?this.options.framePadding:0;let r=2*n,i=0;e.metric&&(r+=this.options.fontSize+5,i=Math.max(i,e.metric.pixelWidth)),e.imperial&&(r+=this.options.fontSize+5,i=Math.max(i,e.imperial.pixelWidth));const a=i+2*n+2*o,s=r+2*o;this._canvas.width=a*t,this._canvas.height=s*t,this._canvas.style.width=a+"px",this._canvas.style.height=s+"px",this._ctx.scale(t,t),this._ctx.clearRect(0,0,a,s),this.options.showFrame&&(this._ctx.globalAlpha=this.options.transparency,this._ctx.fillStyle=this.options.backgroundColor,this._ctx.fillRect(0,0,a,s),this._ctx.globalAlpha=1,this._ctx.strokeStyle=this.options.frameColor,this._ctx.lineWidth=this.options.frameWidth,this._ctx.strokeRect(.5,.5,a-1,s-1)),this._ctx.globalAlpha=1,this._ctx.font=`${this.options.fontSize}px ${this.options.fontFamily}`,this._ctx.textAlign="center",this._ctx.textBaseline="middle";let l=o+n;e.metric&&(this._drawScale(e.metric.distance+" "+e.metric.unit,e.metric.pixelWidth,l,o+n,a),l+=this.options.fontSize+5),e.imperial&&this._drawScale(e.imperial.distance+" "+e.imperial.unit,e.imperial.pixelWidth,l,o+n,a)}_drawScale(e,t,n,o,r){const i=r/2,a=i-t/2,s=i+t/2,l=n+this.options.fontSize/2;this._ctx.strokeStyle=this.options.strokeColor,this._ctx.lineWidth=this.options.strokeWidth,this._ctx.beginPath(),this._ctx.moveTo(a,l),this._ctx.lineTo(s,l),this._ctx.moveTo(a,l-3),this._ctx.lineTo(a,l+3),this._ctx.moveTo(s,l-3),this._ctx.lineTo(s,l+3),this._ctx.stroke(),this._ctx.fillStyle=this.options.textColor,this._ctx.fillText(e,i,l-this.options.fontSize/2-2)}setOptions(e){Object.assign(this.options,e),this._update()}getOptions(){return{...this.options}}}e.exports=o}])}));