<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Checkered Scalebar Test</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .test-info { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            background: white; 
            padding: 10px; 
            border-radius: 5px;
            font-family: Arial, sans-serif;
            font-size: 12px;
            max-width: 350px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-controls {
            margin-top: 10px;
        }
        .test-controls button {
            margin: 2px;
            padding: 5px 10px;
            border: none;
            background: #007cbf;
            color: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        .test-controls button:hover {
            background: #005a87;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="test-info">
        <h3 style="margin: 0 0 10px 0;">Checkered Scalebar Test</h3>
        <p>Testing both line and checkered scalebar styles. The checkered style mimics the ArcGIS scale bar pattern you requested.</p>
        
        <div class="test-controls">
            <button onclick="setStyle('line')">Line Style</button>
            <button onclick="setStyle('checkered')">Checkered Style</button>
            <button onclick="testPresets()">Test All Presets</button>
        </div>
        
        <div style="margin-top: 10px; font-size: 11px; color: #666;">
            <strong>Current style:</strong> <span id="currentStyle">line</span><br>
            <strong>Current zoom:</strong> <span id="currentZoom">12</span><br>
            <strong>Current lat:</strong> <span id="currentLat">40.71</span>
        </div>
    </div>

    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <script src="src/mapbox-scalebar.js"></script>
    <script>
        // Test token (will show error but plugin functionality can still be tested)
        mapboxgl.accessToken = 'pk.test.token';
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-74.006, 40.7128], // New York City
            zoom: 12
        });

        // Create scalebar with checkered style
        const scalebar = new MapboxScalebar({
            units: 'both',
            maxWidth: 200,
            style: 'checkered',
            checkeredHeight: 10,
            checkeredSegments: 5,
            checkeredColor1: '#ffffff',
            checkeredColor2: '#000000',
            strokeColor: '#333333',
            textColor: '#333333',
            showFrame: true,
            backgroundColor: 'rgba(255, 255, 255, 0.95)',
            transparency: 0.95
        });

        map.addControl(scalebar, 'bottom-left');

        // Update info display
        function updateInfo() {
            const center = map.getCenter();
            document.getElementById('currentZoom').textContent = map.getZoom().toFixed(1);
            document.getElementById('currentLat').textContent = center.lat.toFixed(2);
        }

        map.on('move', updateInfo);
        map.on('zoom', updateInfo);

        function setStyle(style) {
            scalebar.setOptions({ style: style });
            document.getElementById('currentStyle').textContent = style;
        }

        function testPresets() {
            const presets = [
                {
                    name: 'Classic Checkered',
                    options: {
                        style: 'checkered',
                        checkeredHeight: 8,
                        checkeredSegments: 4,
                        checkeredColor1: '#ffffff',
                        checkeredColor2: '#000000',
                        strokeColor: '#000000'
                    }
                },
                {
                    name: 'Large Checkered',
                    options: {
                        style: 'checkered',
                        checkeredHeight: 15,
                        checkeredSegments: 6,
                        checkeredColor1: '#f0f0f0',
                        checkeredColor2: '#333333',
                        strokeColor: '#000000'
                    }
                },
                {
                    name: 'Colored Checkered',
                    options: {
                        style: 'checkered',
                        checkeredHeight: 12,
                        checkeredSegments: 8,
                        checkeredColor1: '#e3f2fd',
                        checkeredColor2: '#1976d2',
                        strokeColor: '#0d47a1',
                        textColor: '#0d47a1'
                    }
                }
            ];

            let currentPreset = 0;
            
            function cyclePresets() {
                if (currentPreset < presets.length) {
                    const preset = presets[currentPreset];
                    console.log('Testing preset:', preset.name);
                    scalebar.setOptions(preset.options);
                    document.getElementById('currentStyle').textContent = 'checkered (' + preset.name + ')';
                    currentPreset++;
                    setTimeout(cyclePresets, 2000);
                } else {
                    // Reset to default
                    setStyle('checkered');
                }
            }
            
            cyclePresets();
        }

        // Handle map errors (expected due to test token)
        map.on('error', function(e) {
            console.log('Map error expected (test token):', e.error?.message?.substring(0, 50));
        });

        // Test different zoom levels
        const testLocations = [
            { name: 'World View', center: [0, 0], zoom: 2 },
            { name: 'Country View', center: [-98, 39], zoom: 5 },
            { name: 'City View', center: [-74.006, 40.7128], zoom: 12 },
            { name: 'Street View', center: [-74.006, 40.7128], zoom: 16 }
        ];

        let locationIndex = 0;
        setInterval(() => {
            const location = testLocations[locationIndex % testLocations.length];
            map.setCenter(location.center);
            map.setZoom(location.zoom);
            console.log('Testing at:', location.name, 'Zoom:', location.zoom);
            locationIndex++;
        }, 5000);

        // Initialize
        setTimeout(() => {
            updateInfo();
            console.log('Checkered scalebar test initialized');
            console.log('Plugin options:', scalebar.getOptions());
        }, 1000);
    </script>
</body>
</html>